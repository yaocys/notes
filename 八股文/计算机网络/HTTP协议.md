# Http（超文本传输）协议

## 概述

定义了 浏览器（万维网客户端）怎样向万维网服务器请求万维网文档，以及服务器怎样将文档传送给浏览器

> 层次：面向事务的**应用层**协议，默认80端口
>
> 使用了面向连接的TCP协议作为传输层协议，保证了数据的可靠传输。但是协议本身是***无连接***的
>
> http/1.1使用**持续连接**解决了同一用户高并发的重复性能开销问题

## 报文结构

http报文结构

## HTTP协议版本

#### http/0.9

最初版本，只有一个命令GET，服务器只能回应HTML格式字符串

#### http/1.0

* 引入了新的命令POST和HEAD

* 头信息是ASCII码，后面数据可为任何格式。服务器回应时会告诉客户端：数据是什么格式。即Content-Type字段

  > （text/xml/image/jpeg/audio/mp3）

  这些数据类型总称为MIME（多用途互联网邮件拓展），每个值包括一级类型和二级类型，预定义的类型，也可自定义类型

* 默认短连接：每个TCP连接只能发送一个请求，数据发送完毕即关闭（请求其他资源则需新建连接）

  > 如果想要保持长连接，需要在请求头中加上Connection: keep-alive

#### http/1.1

* 新增方法：PUT、PATCH、OPTIONS、DELETE、TRACE

* 引入了持久连接（长连接），TCP连接默认不关闭，可以被多个请求复用，不用声明Connection：keep-alive

> 对于同一个域名，大多数浏览器允许同时建立6个持久，引入了管道机制，进一步改进了http协议的效率
>
> 管道机制：在同一个TCP连接里，客户端可以同时发送多个请求

* 同一个TCP连接里，所有的数据通信是按次序进行的，服务器只能顺序处理回应。假如前面的回应慢，会造成“队头阻塞”

> 服务器端的响应队列阻塞

解决方法：减少请求数，同时多开持久连接



#### 面试题 http/1.0 和 http/1.1的区别

1. **长连接**

   http/1.1 支持长连接和请求流水线处理（管道机制），在一个TCP连接上可以传送多个Http请求和响应，减少了建立和关闭连接的消耗和延迟

   > 管道机制：每一次发送请求后不用等待回复后再发送下一次请求

   在http/1.1中默认开启Connnection：keep-alive，弥补了http/1.0每次请求都要创建连接的缺点

2. **缓存处理**

   在http/1.0中主要使用header里的If-Modified-Since、Expires来作为缓存判断的标准，http/1.1则引入了更多的缓存控制策略例如：Entity tag、If-Unmodified-Since、If-Match、If-None-Match等更多可供选择的缓存头来控制缓存策略

3. **带宽优化和网络连接的使用**

   http/1.0中存在一些浪费带宽的现象，例如：客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能

   http/1.1则引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial Content），方便了开发者自由选择以便于充分利用带宽和连接

4. **错误通知的管理**

   在http/1.1中新增24个状态响应码，如：

   409（Conflict）：表示请求的资源与资源当前的状态冲突

   410（Gone）：表示服务器上的某个资源被永久性地删除

5. **Host头处理**

   在http/1.0中默认每台服务器绑定一个唯一地IP地址，因此，请求消息中URL并没有传递主机名（hosename）

   但随着虚拟主机技术地发展，在一台物理服务器上可以存在多个虚拟主机（Multihomed Web Servers），并且它们共享一个IP地址。htpp/1.1地请求消息和响应消息都应支持Host头域，且请求消息中如果没有Host头域会报告一个错误（400 Bad Request）

http/1.1遗漏问题：

1. 传输的数据是明文
2. header头部数据太长
3. 每次传输还是要重新连接
4. server不能主动push

#### http/2.0

1. 头数据和数据体都是**二进制**，称为头信息帧和数据帧

   > 1.1仍然是文本格式

2. 复用tcp连接，在一个连接里，**客户端和浏览器都可以同时发送多个请求或回应**，而不用顺序一一对应，避免了“队头阻塞”

3. 引入头部压缩机制，头信息使用gzip/compress压缩后再发送；客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，不发送同样字段，只发送索引号，提高速度

4. ==允许服务器推送==（未经请求，主动向客户端发送资源）

### https的加密

使用的是非对称加密，即对称加密和非对称加密都有，而且还引入了CA机构

#### 非对称加密

即：使用CA机构来保证非对称加密的公钥的传输，然后使用非对称加密来加密传输堆成加密的密钥

#### 过程