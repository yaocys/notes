# 计算机网络

## 体系结构

### OSI七层协议

分七层——支持异构网络的互联互通，自底向下依次为：

1. 物理层

   任务：透明地传输比特流

   功能：为数据段设备提供传送数据通路

   传输单位：比特

2. 数据链路层

   任务：将网络层传输下来的IP数据报组装成帧

   功能：

   1. 链路连接的建立、拆除和分离
   2. 帧定界和帧同步
   3. 差错检测

   传输单位：帧

3. 网络层

   任务：

   1. 将传输层传下来的报文封装成分组
   2. 选择合适的路由，使得传输层传下来的分组能够交付到目的主机

   功能：

   1. 为传输层提供服务
   2. 组包和拆包
   3. 路由选择
   4. 拥塞控制

4. 传输层

   任务：负责主机中两个进程间的通信

   功能：

   1. 为端到端连接提供可靠的服务
   2. 为端到端连接提供流量控制、差错控制、服务质量等管理服务

   传输单位：报文段（TCP）/用户数据报（UDP）

5. 会话层

   任务：不同主机上各进程的对话

6. 表示层

7. 应用层

   任务：提供系统与用户的接口

---

网络层为主机之间提供逻辑通信，而运输层为应用进程之间提供**端到端**的逻辑通信

### TCP协议

主要干什么？流量控制、拥塞控制、消息重传、滑动窗口

* 特点：

  1. 面向连接的：应用程序在使用TCP协议之前，必须先建立TCP连接；传送数据完毕后，必须释放已建立的连接

  2. 每一条TCP连接只能有两个**端点（套接字）**：

     **TCP连接 :: = {socket1,socket2} = {（IP1：port1），（IP2：port2）}**

  3. TCP提供可靠交付的服务：无差错、不丢失、不重复、按序到达

  4. 提供全双工通信：并且两端都设有缓存

  5. 面向字节流：TCP可能调整数据块长度

* 连续ARQ（自动重传请求协议）

* 首部格式（最小20字节）：

  **源端口2 目的端口2 序号4 确认号4 数据偏移4 保留6 **

  控制位：**紧急URG 确认ACK 推送PSH 复位RST 同步SYN 终止FIN**

  **窗口2 检验和2 紧急指针2 选项**

  序号：本报文段所发送的数据的第一个字节的序号（唯一） 

  确认号：期望收到对方下一个报文段的第一个数据字节的序号

  数据偏移：数据起始处距报文段起始处有多远（即**首部长度**）

  URG=1：紧急，配合紧急指针使用ee；ACK=0：确认号无效；PSH立即响应，不攒缓存；RST重置连接；连接请求；释放连接

  窗口：作为接收方让发送方设置其发送窗口的依据



#### 滑动窗口

以字节为单位

* 通过”滑动窗口“实现流量控制：持续计时器

  窗口的大小由接收方给出

#### 拥塞控制

慢开始算法：初始值极小，但成倍增加

拥塞避免算法：线性增长

快重传&快恢复：解决因报文段丢失而导致发送端超时，误认为网络发生”拥塞“

### UDP协议

* 特点：
  1. 无连接的：发送数据之前不需要建立连接
  2. 尽最大努力交付：不保证可靠交付（主机不需要维持复杂的连接状态表）
  3. 面向报文：发送/接收方的UDP对应用程序交下来的报文，在添加/去除首部后就向下交付IP层
  4. 没有拥塞控制
  5. 支持一对一、一对多、多对一、多对多
  6. 首部开销小

* 首部格式（最小8字节）：源端口 目的端口 长度 校验和

* 伪首部 用于 计算校验和

## 分隔

### 浏览器打开一个链接经历了哪些过程

1. DNS解析
2. 端口分析
3. TCP请求
4. 服务器处理请求
5. 服务器响应
6. 浏览器解析
7. 链接关闭