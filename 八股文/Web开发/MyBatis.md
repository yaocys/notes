# MyBatis

1. ***$和#的区别***

   使用#设置参数，MyBatis会创建预编译的SQL语句，并在执行SQL语句时为预编译SQL中的占位符（?）赋值；预编译的SQL语句**执行效率高**，且**可以防止注入攻击**

   使用$设置参数，MyBatis只是创建普通的SQL语句，执行SQL时直接将参数拼入到SQL里；效率、安全性均不如上者；但可以解决特殊情况下的问题，例如：为动态表格传递列名、或根据某些列进行排序

2. ***MyBatis的缓存机制***

   MyBatis的缓存分为一级缓存和二级缓存

   **一级缓存**

   也叫本地缓存，默认启用且不能关闭。

   存在于SqlSession的生命周期中。

   在同一个 SqlSession 中查询时，MyBatis 会把执行的方法和参数通过算法生成缓存的键值，将键值和查询结果存入一个Map对象中。如果同一个SqlSession 中执行的方法和参数完全一致，那么通过算法会生成相同的键值，当Map 缓存对象中己经存在该键值时，则会返回缓存中的对象。

   **二级缓存**

   二级缓存存在于SqlSessionFactory 的生命周期中

   若想使用二级缓存，需要在如下两处进行配置：

   1. MyBatis 的全局配置settings 中有一个参数cacheEnabled，是二级缓存的全局开关，默认值是true启用状态
   2. MyBatis 的二级缓存是和命名空间绑定的，即二级缓存需要配置在Mapper.xml 映射文件中。在保证二级缓存的全局配置开启的情况下，给Mapper.xml 开启二级缓存只需要在Mapper. xml 中添加`<cache/>`

   二级缓存具有如下效果：

   - 映射语句文件中的所有SELECT 语句将会被缓存。
   - 映射语句文件中的所有时INSERT 、UPDATE 、DELETE 语句会刷新缓存。
   - 缓存会使用Least Rece ntly U sed ( LRU ，最近最少使用的）算法来收回。
   - 根据时间表（如no Flush Int erv al ，没有刷新间隔），缓存不会以任何时间顺序来刷新。
   - 缓存会存储集合或对象（无论查询方法返回什么类型的值）的1024 个引用。
   - 缓存会被视为read/write（可读／可写）的，意味着对象检索不是共享的，而且可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。