# 系统设计

---

## 修改

### 用户表

首先，会员表新增一个账户金额字段，充值的钱就放在这里

* 修改删除用户，之前是有课程不能删，现在在加上账户金额>0不能删，后面还要会员卡未到期不能删，处理则是返回提示信息“课程/健身卡未到期，请结算业务后注销”“账户余额未结算，请结算后注销”

### 课程表

新增类型（私人、团课）、容量字段

### 课程表

==原有的三个管理：教练信息、课程信息、会员信息不变，即教练管理、会员管理、课程管理模块不变==

==课程表拆分为“课程-教练”和“课程-学员”两个表==

选课拆分为：分配教练和学员报班两个模块

* 分配教练：即往课程-教练表中插入数据
* 学员报班就比较复杂，参考开卡

## 新增“课程一览”模块

（其实本来就设计了，没做而已）

显示三张表中的简要数据

| 课程名称 | 教练 | 课程类型                                      | 开课时间 | 行课   | 开课次数 | 学员人数/容量                                                |
| -------- | ---- | --------------------------------------------- | -------- | ------ | -------- | ------------------------------------------------------------ |
| 游泳入门 | 张三 | 团课                                          | 2022-6-1 | 每周日 | 8        | 6/10                                                         |
|          |      | 这个通过课程容量判断，1私教，<5小班，其他大班 |          |        |          | 这里我要点一下能看到有哪些学员，就像你之前做的”选课“，点一下下面会显示 |



## 健身卡设计

### 卡片信息表 

新增卡片分为次卡和时间卡

* 次卡每次签到，可用次数-1，但是要注意用户当天多次入场的情况只能算一次
* 时间卡到期失效

提供的卡片面额

| 类型   | 价格 | 次数/天数 | 备注        |
| ------ | ---- | --------- | ----------- |
| 临时   | 20   | 1         |             |
| 次卡   | 99   | 7         | 有效期49天  |
| 次卡   | 299  | 30        | 有效期210天 |
| 时间卡 | 199  | 月卡30天  |             |
| 时间卡 | 699  | 季卡120天 |             |
| 时间卡 | 1599 | 年卡360天 |             |

![image-20220526010037790](C:\Users\yaosu\AppData\Roaming\Typora\typora-user-images\image-20220526010037790.png)

> 备注：此表暂时只提供查询，一共6个卡面可选
>
> id自增
>
> type：1表示时间（临时）卡，2表示次卡
>
> times：表示可用次数，时间卡-1表示无限
>
> > 这里想到个问题，如果次卡用户当天多次进场，一次有效期应该是一天
> >
> > 后面开发要注意
>
> days：表示有效期，没错，次卡也有效期

### 健身卡-用户表

![image-20220526012011772](C:\Users\yaosu\AppData\Roaming\Typora\typora-user-images\image-20220526012011772.png)

### 业务流程

#### 开卡

* 前端获取后端卡片信息，并展示可选卡种（大按钮）

  返回后端一个卡种id，一个用户id

* 后端获取到后，先通过卡种查卡片信息，再根据用户id确认用户金额是否足够，扣除金额后，最后把卡种信息更新到“健身-用户表”中去

## 签到

用户输入电话号码/会员卡号

后端去查该用户的会员卡身份是否有效（课程是否有效，有效也让进，但是我们先不考虑）并标记（要注意次卡标记是一天）

返回给前端签到结果和当月登录情况

## 说明

1. 这只是初版构想，最主要只考虑了整体逻辑、业务逻辑合理，可行性、做不做、要不要这么做还有待商榷（估计是做不完的，作为课程设计大家也不愿意做这么复杂）
2. 这只是初版构想，很多具体实现细节没仔细考虑（今晚我肝不下去了）